var id=0,markers=[];iw=new google.maps.InfoWindow;var newMarker,map,overlay,iw,canvasLayer,mouseStartDrag=[0,0],activePointPin=[47,128],resolutionScale=window.devicePixelRatio||1;function DeleteMarker(e){for(var t=0;t<markers.length;t++)if(markers[t].id==e)return markers[t].setMap(null),void markers.splice(t,-1)}(overlay=new google.maps.OverlayView).draw=function(){},overlay.setMap(map),elevator=new google.maps.ElevationService,console.log("MGRS Mapper by James Pistell"),$(window).on("load",function(){function t(){$(".draggable").draggable({revert:!0,stack:".draggable",helper:"clone"}),$("#map").droppable({accept:".draggable",drop:function(e,t){iw&&iw.close(),document.getElementsByClassName("dragAndDropNotification")[0].style.display="none";var o=0,n=$(this),i=t.draggable,r=[e.clientX-$("#map").position().left,e.clientY-$("#map").position().top];r=[r[0]+activePointPin[0]-mouseStartDrag[0],r[1]+activePointPin[1]-mouseStartDrag[1]];var l=overlay.getProjection().fromContainerPixelToLatLng(new google.maps.Point(r[0],r[1])),a=$(".svg-symbol img").attr("src"),c=$(".svg-symbol img").attr("height"),s=$(".svg-symbol img").attr("width");image=new google.maps.MarkerImage(a,null,null,null);var u=new google.maps.Marker({map:map,position:l,draggable:!0,icon:image,id:id++,optimized:!1,zIndex:o,funcid:document.getElementsByClassName("funcid")[0].innerText.split("-").slice(-2).reverse().join(", ")});markers.push(u);var d=u.funcid,m=document.querySelectorAll(".mdc-select__selected-text")[1].innerText,g=document.querySelectorAll(".mdc-select__selected-text")[5].innerText,p=document.querySelectorAll(".mdc-select__selected-text")[6].innerText,v=document.querySelector("#uniqueDesignation").value,y=document.querySelector("#higherFormation").value,_=document.querySelector("#outlineWidth").attributes[6].value,f=document.querySelector("#outlineColor .mdc-select__selected-text").innerText,S=document.querySelector(".search input").value;gtag("event","Marker Dropped",{unit:d,affiliation:m,hq_selected:g,unit_size:p,unique_unit_designation:v,higher_formation:y,symbol_outline_width:_,symbol_outline_color:f,search_string:S}),u.icon.scaledSize=new google.maps.Size(s,c),google.maps.event.addListener(u,"click",function(e){actual=u;var t=actual.getPosition().lat(),o=actual.getPosition().lng(),n="<div class='infowindow'><h6><span style='color: red;'>Lat/Lon: </span>"+t.toFixed(6)+", "+o.toFixed(6)+"</h6></div>",i="<div class='MGRS'><h6><span style='color: red;'>MGRS: </span>"+USNG.LLtoUSNG(t,o,5)+"</h6></div>";iw.setContent(n+i),iw.open(map,this)}),gtag("event","Marker Dropped",{unit:u.funcid,affiliation:document.querySelectorAll(".mdc-select__selected-text")[1].innerText,HQ:document.querySelectorAll(".mdc-select__selected-text")[5].innerText,unit_size:document.querySelectorAll(".mdc-select__selected-text")[6].innerText,unique_unit_designation:document.querySelector("#uniqueDesignation").value,higher_formation:document.querySelector("#higherFormation").value,symbol_outline_width:document.querySelector("#outlineWidth").attributes[6].value,symbol_outline_color:document.querySelector("#outlineColor .mdc-select__selected-text").innerText,search_string:document.querySelector(".search input").value}),google.maps.event.addListener(u,"click",function(e){var i,t,r;i=e.latLng,t=elevator,r=iw,t.getElevationForLocations({locations:[i]},function(e,t){if(r.setPosition(i),"OK"===t)if(e[0]){var o="<div class='Elevation'><h6><span style='color: red;'>Elevation: </span>"+parseInt(e[0].elevation)+" meters</h6></div>";o+="<h6><span style='color: red;'>Unit: </span>"+u.funcid+"</h6>",o+="<input type = 'button' value = 'Delete' onclick = 'DeleteMarker("+u.id+")'/>";var n=document.querySelector(".MGRS");n.innerHTML=n.innerHTML+o}else r.setContent("No results found");else r.setContent("Elevation service failed due to: "+t)})}),google.maps.event.addListener(u,"dragstart",function(){actual=u,actual==u&&iw.close(),o+=1,u.setZIndex(o)}),google.maps.event.addListener(map,"click",function(){iw&&iw.close()}),i.clone().appendTo(n)}})}t();var e=document.querySelector("#toolbar");new MutationObserver(function(e){e.forEach(function(e){"attributes"==e.type&&(t(),"Ground Equipment"===document.querySelector(".battle_dim").innerText?document.querySelector(".sym_mod_2").innerText="Symbol Modifier 2":document.querySelector(".sym_mod_2").innerText="Unit Size")})}).observe(e,{attributes:!0,subtree:!0})});