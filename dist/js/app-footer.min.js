var id=0,markers=[];iw=new google.maps.InfoWindow;var newMarker,map,overlay,iw,canvasLayer,mouseStartDrag=[0,0],activePointPin=[47,128],resolutionScale=window.devicePixelRatio||1;function DeleteMarker(e){for(var t=0;t<markers.length;t++)if(markers[t].id==e)return markers[t].setMap(null),void markers.splice(t,-1)}(overlay=new google.maps.OverlayView).draw=function(){},overlay.setMap(map),elevator=new google.maps.ElevationService,console.log("MGRS Mapper by James Pistell"),$(window).on("load",function(){function t(){$(".draggable").draggable({revert:!0,stack:".draggable",helper:"clone"}),$("#map").droppable({accept:".draggable",drop:function(e,t){iw&&iw.close(),document.getElementsByClassName("dragAndDropNotification")[0].style.display="none";var o=0,n=$(this),a=t.draggable,i=[e.clientX-$("#map").position().left,e.clientY-$("#map").position().top];i=[i[0]+activePointPin[0]-mouseStartDrag[0],i[1]+activePointPin[1]-mouseStartDrag[1]];var r=overlay.getProjection().fromContainerPixelToLatLng(new google.maps.Point(i[0],i[1])),l=$(".svg-symbol img").attr("src"),s=$(".svg-symbol img").attr("height"),c=$(".svg-symbol img").attr("width");image=new google.maps.MarkerImage(l,null,null,null);var d=new google.maps.Marker({map:map,position:r,draggable:!0,icon:image,id:id++,optimized:!1,zIndex:o,funcid:document.getElementsByClassName("funcid")[0].innerText.split("-").slice(-2).reverse().join(", ")});markers.push(d),d.icon.scaledSize=new google.maps.Size(c,s),google.maps.event.addListener(d,"click",function(e){actual=d;var t=actual.getPosition().lat(),o=actual.getPosition().lng(),n="<div class='infowindow'><h6><span style='color: red;'>Lat/Lon: </span>"+t.toFixed(6)+", "+o.toFixed(6)+"</h6></div>",a="<div class='MGRS'><h6><span style='color: red;'>MGRS: </span>"+USNG.LLtoUSNG(t,o,5)+"</h6></div>";iw.setContent(n+a),iw.open(map,this)}),google.maps.event.addListener(d,"click",function(e){var a,t,i;a=e.latLng,t=elevator,i=iw,t.getElevationForLocations({locations:[a]},function(e,t){if(i.setPosition(a),"OK"===t)if(e[0]){var o="<div class='Elevation'><h6><span style='color: red;'>Elevation: </span>"+parseInt(e[0].elevation)+" meters</h6></div>";o+="<h6><span style='color: red;'>Unit: </span>"+d.funcid+"</h6>",o+="<br /><input type = 'button' value = 'Delete' onclick = 'DeleteMarker("+d.id+")' value = 'Delete' />";var n=document.querySelector(".MGRS");n.innerHTML=n.innerHTML+o}else i.setContent("No results found");else i.setContent("Elevation service failed due to: "+t)})}),google.maps.event.addListener(d,"dragstart",function(){actual=d,actual==d&&iw.close(),o+=1,d.setZIndex(o)}),google.maps.event.addListener(map,"click",function(){iw&&iw.close(),contextMenu&&contextMenu.hide()}),a.clone().appendTo(n)}})}t();var e=document.querySelector("#toolbar");new MutationObserver(function(e){e.forEach(function(e){"attributes"==e.type&&(t(),"Ground Equipment"===document.querySelector(".battle_dim").innerText?document.querySelector(".sym_mod_2").innerText="Symbol Modifier 2":document.querySelector(".sym_mod_2").innerText="Unit Size")})}).observe(e,{attributes:!0,subtree:!0})});